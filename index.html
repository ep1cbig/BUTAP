<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUTAPP - Sebastian Manduca</title>
    <!-- Configuración para PWA / App Móvil -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3299/3299935.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f0fdf4; -webkit-tap-highlight-color: transparent; }
        .camera-container { position: relative; width: 100%; max-width: 500px; aspect-ratio: 3/4; overflow: hidden; border-radius: 32px; box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1); border: 4px solid white; }
        video { width: 100%; height: 100%; object-fit: cover; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .scan-line { position: absolute; width: 100%; height: 2px; background: #22c55e; top: 0; animation: scan 3s linear infinite; box-shadow: 0 0 15px #22c55e; }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }
        .btn-active { background-color: #16a34a !important; color: white !important; transform: scale(1.05); }
    </style>
</head>
<body class="p-4 md:p-8 flex flex-col items-center min-h-screen">

    <header class="text-center mb-6">
        <h1 class="text-5xl font-extrabold text-green-700 tracking-tighter">BUTAPP</h1>
        <p class="text-xs text-green-600 font-bold mt-1 uppercase tracking-widest">Sebastian Manduca &copy; 2026</p>
        
        <div class="mt-6 flex gap-3 justify-center">
            <button onclick="setLanguage('es')" id="btn-es" class="px-5 py-2 rounded-2xl bg-white text-green-700 shadow-sm font-bold transition-all border border-green-100">Español</button>
            <button onclick="setLanguage('it')" id="btn-it" class="px-5 py-2 rounded-2xl bg-white text-green-700 shadow-sm font-bold transition-all border border-green-100">Italiano</button>
        </div>
    </header>

    <div class="camera-container bg-black mb-6">
        <video id="video" autoplay playsinline muted></video>
        <div class="overlay"><div class="scan-line"></div></div>
        <div id="loading-model" class="absolute inset-0 flex flex-col items-center justify-center bg-black/80 text-white text-sm px-6 text-center">
            <div class="w-10 h-10 border-4 border-green-500 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p class="font-bold">Iniciando IA Ambiental...</p>
            <p class="text-[10px] text-gray-400 mt-2">MobileNet Model by TensorFlow</p>
        </div>
        <div id="prediction-box" class="absolute bottom-6 left-1/2 -translate-x-1/2 bg-white/95 backdrop-blur-md px-8 py-4 rounded-3xl shadow-2xl text-center min-w-[240px] hidden border border-green-100">
            <p id="label-today" class="text-[10px] uppercase font-black text-green-600 mb-1 tracking-widest"></p>
            <p id="prediction-text" class="text-2xl font-black text-gray-800"></p>
        </div>
    </div>

    <div class="w-full max-w-md bg-white p-8 rounded-[40px] shadow-xl shadow-green-900/5 border border-green-50">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 id="title-calendar" class="text-2xl font-black text-gray-800 tracking-tight">Calendario Hoy</h2>
                <p id="date-text" class="text-[10px] text-green-600 font-bold uppercase tracking-widest"></p>
            </div>
            <button onclick="speakToday()" class="w-14 h-14 bg-green-600 rounded-2xl flex items-center justify-center hover:bg-green-700 transition-transform active:scale-90 shadow-lg shadow-green-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M11 5L6 9H2v6h4l5 4V5z"></path><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
            </button>
        </div>
        <div id="today-info" class="p-6 bg-gray-50 rounded-3xl border-2 border-dashed border-gray-200">
            <p id="waste-text" class="text-3xl font-black text-green-900 leading-tight">Calculando...</p>
        </div>
    </div>

    <div class="mt-8 text-center max-w-xs">
        <p class="text-[10px] text-gray-400 font-medium leading-relaxed">
            Esta es una aplicación de código abierto creada para ayudar a la comunidad. 
            <br><span class="text-green-600 font-bold italic text-[11px]">"Protegiendo el medio ambiente juntos"</span>
        </p>
        <div class="mt-4 p-3 bg-white/50 rounded-xl border border-gray-100">
            <p class="text-[9px] text-gray-500 uppercase font-bold mb-1">Licencia MIT</p>
            <p class="text-[9px] text-gray-400">Permitido el uso, copia y distribución gratuita mencionando al autor: <strong>Sebastian Manduca</strong>.</p>
        </div>
    </div>

    <script>
        let currentLang = 'es';
        let model = null;
        const video = document.getElementById('video');
        
        const translations = {
            es: {
                today: "Hoy se tira:",
                calendarTitle: "Calendario",
                scanning: "ESCANEANDO RESIDUO",
                speechPrefix: "Atención ciudadano. Hoy te toca tirar ",
                none: "Nada hoy / Niente oggi",
                recognizing: "Reconociendo..."
            },
            it: {
                today: "Oggi si butta:",
                calendarTitle: "Calendario",
                scanning: "SCANSIONE RIFIUTI",
                speechPrefix: "Attenzione cittadino. Oggi devi buttare ",
                none: "Niente oggi",
                recognizing: "Riconoscimento..."
            }
        };

        const calendar = {
            "0-2": "Secco Residuo / Vetro", "0-3": "Organico", "0-5": "Organico", "0-7": "Carta / Plastica Metalli",
            "0-8": "Organico", "0-9": "Secco Residuo / Vetro", "0-10": "Organico", "0-12": "Organico",
            "0-13": "Carta", "0-14": "Plastica Metalli", "0-15": "Organico", "0-16": "Secco Residuo / Vetro",
            "0-17": "Organico", "0-19": "Organico", "0-20": "Carta", "0-21": "Plastica Metalli",
            "0-22": "Organico", "0-23": "Secco Residuo / Vetro", "0-24": "Organico", "0-26": "Organico",
            "0-27": "Carta", "0-28": "Plastica Metalli", "0-29": "Organico", "0-30": "Secco Residuo / Vetro", "0-31": "Organico",
            "1-2": "Organico", "1-3": "Carta", "1-4": "Plastica Metalli", "1-5": "Organico", "1-6": "Secco Residuo / Vetro",
            "1-7": "Organico", "1-9": "Organico", "1-10": "Carta", "1-11": "Plastica Metalli", "1-12": "Organico",
            "1-13": "Secco Residuo / Vetro", "1-14": "Organico", "1-16": "Organico", "1-17": "Carta", "1-18": "Plastica Metalli",
            "1-19": "Organico", "1-20": "Secco Residuo / Vetro", "1-21": "Organico", "1-23": "Organico", "1-24": "Carta",
            "1-25": "Plastica Metalli", "1-26": "Organico", "1-27": "Secco Residuo / Vetro", "1-28": "Organico",
            "2-2": "Organico", "2-3": "Carta", "2-4": "Plastica Metalli", "2-5": "Organico", "2-6": "Secco Residuo / Vetro",
            "2-7": "Organico", "2-9": "Organico", "2-10": "Carta", "2-11": "Plastica Metalli", "2-12": "Organico",
            "2-13": "Secco Residuo / Vetro", "2-14": "Organico", "2-16": "Organico", "2-17": "Carta", "2-18": "Plastica Metalli",
            "2-19": "Organico", "2-20": "Secco Residuo / Vetro", "2-21": "Organico", "2-23": "Organico", "2-24": "Carta",
            "2-25": "Plastica Metalli", "2-26": "Organico", "2-27": "Secco Residuo / Vetro", "2-28": "Organico", "2-30": "Organico", "2-31": "Carta",
            "3-1": "Plastica Metalli", "3-2": "Organico", "3-3": "Secco Residuo / Vetro", "3-4": "Organico", "3-7": "Organico",
            "3-8": "Carta / Plastica Metalli", "3-9": "Organico", "3-10": "Secco Residuo / Vetro", "3-11": "Organico",
            "3-13": "Organico", "3-14": "Carta", "3-15": "Plastica Metalli", "3-16": "Organico", "3-17": "Secco Residuo / Vetro",
            "3-18": "Organico", "3-20": "Organico", "3-21": "Carta / Plastica Metalli", "3-22": "Organico", "3-23": "Secco Residuo / Vetro",
            "3-24": "Organico", "3-27": "Organico", "3-28": "Carta / Plastica Metalli", "3-29": "Organico", "3-30": "Secco Residuo / Vetro",
            "4-2": "Organico", "4-4": "Organico", "4-5": "Carta", "4-6": "Plastica Metalli", "4-7": "Organico",
            "4-8": "Secco Residuo / Vetro", "4-9": "Organico", "4-11": "Organico", "4-12": "Carta", "4-13": "Plastica Metalli",
            "4-14": "Organico", "4-15": "Secco Residuo / Vetro", "4-16": "Organico", "4-18": "Organico", "4-19": "Carta",
            "4-20": "Plastica Metalli", "4-21": "Organico", "4-22": "Secco Residuo / Vetro", "4-23": "Organico", "4-25": "Organico",
            "4-26": "Carta", "4-27": "Plastica Metalli", "4-28": "Organico", "4-29": "Secco Residuo / Vetro", "4-30": "Organico",
            "5-1": "Organico", "5-3": "Carta / Plastica Metalli", "5-4": "Organico", "5-5": "Secco Residuo / Vetro",
            "5-6": "Organico", "5-8": "Organico", "5-9": "Carta", "5-10": "Plastica Metalli", "5-11": "Organico",
            "5-12": "Secco Residuo / Vetro", "5-13": "Organico", "5-15": "Organico", "5-16": "Carta", "5-17": "Plastica Metalli",
            "5-18": "Organico", "5-19": "Secco Residuo / Vetro", "5-20": "Organico", "5-22": "Organico", "5-23": "Carta",
            "5-24": "Plastica Metalli", "5-25": "Organico", "5-26": "Secco Residuo / Vetro", "5-27": "Organico", "5-29": "Organico", "5-30": "Carta"
        };

        const wasteMappingIA = {
            "bottle": "Plastica / Vetro", "water bottle": "Plastica", "wine bottle": "Vetro",
            "beer bottle": "Vetro", "glass": "Vetro", "cup": "Plastica", "paper": "Carta",
            "cardboard": "Carta", "can": "Plastica Metalli", "tin": "Plastica Metalli",
            "orange": "Organico", "banana": "Organico", "fruit": "Organico", "vegetable": "Organico"
        };

        async function init() {
            setLanguage('es');
            updateCalendarDisplay();
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                video.srcObject = stream;
            } catch (err) {
                document.getElementById('loading-model').innerHTML = "<p class='font-bold'>⚠️ Error de Cámara</p><p class='text-xs mt-2'>Debes permitir el acceso para que la IA funcione.</p>";
                return;
            }
            checkModelReady();
        }

        function checkModelReady() {
            if (typeof mobilenet !== 'undefined') { loadAIModel(); } 
            else { setTimeout(checkModelReady, 500); }
        }

        async function loadAIModel() {
            try {
                model = await mobilenet.load();
                document.getElementById('loading-model').style.display = 'none';
                document.getElementById('prediction-box').style.display = 'block';
                detectObjects();
            } catch (e) {
                document.getElementById('loading-model').innerText = "Error cargando IA.";
            }
        }

        async function detectObjects() {
            if (model && video.readyState === 4) {
                const predictions = await model.classify(video);
                if (predictions.length > 0) {
                    processPrediction(predictions[0].className.toLowerCase());
                }
            }
            requestAnimationFrame(detectObjects);
        }

        function processPrediction(className) {
            const box = document.getElementById('prediction-text');
            const label = document.getElementById('label-today');
            label.innerText = translations[currentLang].scanning;
            let found = false;
            for (let key in wasteMappingIA) {
                if (className.includes(key)) {
                    box.innerText = wasteMappingIA[key];
                    box.className = "text-2xl font-black text-green-700";
                    found = true; break;
                }
            }
            if (!found) { 
                box.innerText = translations[currentLang].recognizing; 
                box.className = "text-xl font-bold text-gray-300 italic"; 
            }
        }

        function setLanguage(lang) {
            currentLang = lang;
            document.getElementById('btn-es').className = `px-5 py-2 rounded-2xl font-bold transition-all border ${lang === 'es' ? 'btn-active shadow-lg shadow-green-100' : 'bg-white text-green-700'}`;
            document.getElementById('btn-it').className = `px-5 py-2 rounded-2xl font-bold transition-all border ${lang === 'it' ? 'btn-active shadow-lg shadow-green-100' : 'bg-white text-green-700'}`;
            
            document.getElementById('title-calendar').innerText = translations[lang].calendarTitle;
            updateCalendarDisplay();
        }

        function updateCalendarDisplay() {
            const now = new Date();
            const key = `${now.getMonth()}-${now.getDate()}`;
            const waste = calendar[key] || translations[currentLang].none;
            const dateOptions = { weekday: 'long', day: 'numeric', month: 'long' };
            document.getElementById('date-text').innerText = now.toLocaleDateString(currentLang === 'es' ? 'es-ES' : 'it-IT', dateOptions);
            document.getElementById('waste-text').innerText = waste;
        }

        function speakToday() {
            const now = new Date();
            const key = `${now.getMonth()}-${now.getDate()}`;
            const waste = calendar[key] || translations[currentLang].none;
            const message = translations[currentLang].speechPrefix + waste;
            const utterance = new SpeechSynthesisUtterance(message);
            utterance.lang = currentLang === 'es' ? 'es-ES' : 'it-IT';
            utterance.pitch = 1;
            utterance.rate = 1;
            window.speechSynthesis.speak(utterance);
        }

        window.onload = init;
    </script>
</body>
</html>